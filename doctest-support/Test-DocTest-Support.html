<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head id="head" data-base-url=".."><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Test.DocTest.Support</title><link href="../linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="../quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="../haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">doctest-support</span><ul class="links" id="page-menu"><li><a href="src/Test.DocTest.Support.html">Source</a></li><li><a href="../index.html">Contents</a></li><li><a href="../doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Copyright 2024 Ruifeng Xie</td></tr><tr><th>License</th><td>LGPL-3.0-or-later</td></tr><tr><th>Maintainer</th><td>Ruifeng Xie &lt;ruifengx@outlook.com&gt;</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>GHC2021</td></tr></table><p class="caption">Test.DocTest.Support</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Examples</a><ul><li><a href="#g:2">REPL (Read-Eval-Print-Loop) Style Examples</a></li><li><a href="#g:3">QuickCheck Properties</a></li><li><a href="#g:4">Verbatim Examples</a></li><li><a href="#g:5">Verbatim Properties</a></li><li><a href="#g:6">Support API</a></li></ul></li><li><a href="#g:7">Captures</a></li><li><a href="#g:8">Hooks</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Support functions used by code generated by <code>doctest-driver</code>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:shouldMatch">shouldMatch</a> :: (<a href="../base/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a>, <a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a> a, <a href="../base/Prelude.html#t:Show" title="Prelude">Show</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a)) =&gt; a -&gt; <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../HUnit/Test-HUnit-Lang.html#t:Assertion" title="Test.HUnit.Lang">Assertion</a></li><li class="src short"><span class="keyword">type family</span> <a href="#t:ReplResult">ReplResult</a> a <span class="keyword">where ...</span></li><li class="src short"><span class="keyword">class</span> <a href="#t:ReplAction">ReplAction</a> a <span class="keyword">where</span><ul class="subs"><li><a href="#v:replAction">replAction</a> :: a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a)</li></ul></li><li class="src short"><a href="#v:withWriteTempFile">withWriteTempFile</a> :: (<a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a> -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a) -&gt; <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a</li><li class="src short"><a href="#v:textStrict">textStrict</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../text/Data-Text.html#t:Text" title="Data.Text">Text</a></li><li class="src short"><a href="#v:textLazy">textLazy</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../text/Data-Text-Lazy.html#t:Text" title="Data.Text.Lazy">Text</a></li><li class="src short"><a href="#v:byteStringStrict">byteStringStrict</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li><li class="src short"><a href="#v:byteStringLazy">byteStringLazy</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString-Lazy.html#t:LazyByteString" title="Data.ByteString.Lazy">LazyByteString</a></li><li class="src short"><a href="#v:shortByteString">shortByteString</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString-Short.html#t:ShortByteString" title="Data.ByteString.Short">ShortByteString</a></li><li class="src short"><a href="#v:markUsed">markUsed</a> :: a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="doc"><p>Here we demonstrate features of <code>doctest-driver</code>. Readers of this documentation are
 encouraged to also refer to the source code of this module as an illustration.</p></div><a href="#g:1" id="g:1"><h1>Examples</h1></a><div class="doc"><p><code>doctest-driver</code> supports testing Haddock examples.</p></div><a href="#g:2" id="g:2"><h2>REPL (Read-Eval-Print-Loop) Style Examples</h2></a><div class="doc"><p>Each example is one program line starting with <code>&gt;&gt;&gt;</code> followed by zero or more result lines.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>&quot;hello&quot; ++ &quot;, &quot; ++ &quot;world&quot;
</code></strong>&quot;hello, world&quot;
</pre><p>Since <code>doctest-driver</code> extracts the doctests to a test suite and does not rely on GHCi, there
are some subtle edge cases to be aware of.</p><ol><li value="1"><p>GHCi supports evaluating both pure values and <code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> actions. <code>doctest-driver</code> also supports
this via the type class <code><a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a></code> and type family <code><a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a></code>. As a result, if the target
expression to be evaluated has a polymorphic type (in technical terms, the type is not specific
enough to determine whether it matches <code><code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> a</code> or not), the generated test suite will fail to
compile. To fix the issue, add a type signature or use <code>TypeApplications</code> to disambiguate.</p><pre>-- this will not work
&gt;&gt;&gt; 6 * 7
42</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>(6 * 7) :: Int
</code></strong>42
</pre></li><li value="2">GHCi displays the result as a string by calling <code><a href="../base/Prelude.html#v:show" title="Prelude">show</a></code>. The well-known <code>doctest</code> library
additionally supports fuzzy result matching. To replicate these behaviours, we also call <code><a href="../base/Prelude.html#v:show" title="Prelude">show</a></code>
on the program line expression, and perform fuzzy matching against the expected output lines.
This fuzzy matching is implemented in <a href="Test-DocTest-FuzzyMatch.html">Test.DocTest.FuzzyMatch</a>. See <code><a href="Test-DocTest-Support.html#v:shouldMatch" title="Test.DocTest.Support">shouldMatch</a></code> for examples.</li><li value="3"><p>Haddock renders examples adjacent to each other (i.e., not separated by one or more empty
lines) as a single code block. Therefore, we generate one single <code>do</code>-block for each such
example block, which means local variables bound by <code>let</code> or monadic bind (<code>&lt;-</code>) are in scope
up until the current example block ends. To introduce variables shared by multiple example
groups, use one of the hook instructions explained below.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let x = 3 :: Int
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>-- x is now in scope
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>x + 1
</code></strong>4
</pre></li><li value="4"><p>The evaluator plugin in haskell-language-server (HLS) allows writing multiple examples to
be evaluated, and then (following all the examples) all of their results. This requires some
efforts to implement correctly. Additionally, this style makes it harder to tell which output
line comes from which test example, since it is possible for a single test example to have
multiple lines of output. Therefore, we do not support this style.</p><pre>-- this is not supported
&gt;&gt;&gt; 1 + 1 :: Int
&gt;&gt;&gt; 6 * 7 :: Int
2
42</pre><p>The above test case would attempt run <code>1 + 1 :: Int</code> as an <code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> action, and compare the
result of <code>6 * 7 :: Int</code> (after calling <code><a href="../base/Prelude.html#v:show" title="Prelude">show</a></code> as explained above) with the two output
lines, which results in compile errors. The tests should be written as follows, instead:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>1 + 1 :: Int
</code></strong>2
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>6 * 7 :: Int
</code></strong>42
</pre></li><li value="5">GHCi allows type definitions and function definitions without <code>let</code>. Since examples are put
into <code>do</code>-blocks, neither type definitions nor function definitions are allowed. To introduce
such definitions, you must promote them to the top-level using one of the <code>setup</code> instructions
explained below. Alternatively, functions can still be defined locally using <code>let</code>.</li><li value="6"><p>GHCi supports various commands starting with a colon (<code>:</code>). Since we do not use GHCi, these
commands are not supported in <code>doctest-driver</code>. Among all the commands, <code>:{</code> and <code>:}</code> are used
to start and close multiline expressions and definitions in GHCi. The <code>doctest</code> library takes
this syntax and supports multiline test cases as follows:</p><pre>&gt;&gt;&gt; :{
first line
  second line (indented)
  more lines
:}
first line of expected output
more output lines</pre><p>Note the lack of <code>&gt;&gt;&gt;</code> markers for line 2-5: it is a clever trick to avoid the indentation
from being removed by Haddock. However, strictly speaking (from Haddock's perspective),
this test consist of a single line of code (<code>:{</code>) and five lines lines of expected output.
Over all, this syntax does not render in the same way as the test writer, and may look
confusing to users. <code>doctest-driver</code> does not support this syntax. For multiline tests
and properties, one should use verbatim code blocks with appropriate doctest instructions
(<code>test</code> and <code>property</code> respectively) as explained in the following sections.</p></li></ol></div><a href="#g:3" id="g:3"><h2>QuickCheck Properties</h2></a><div class="doc"><p>Each QuickCheck property is one program line starting with <code>prop&gt;</code>. Typically, a property is
written as a lambda expression, with multiple parameters (considered universally quantified).
The <code>doctest</code> library allows omitting the binders; under the hood, it uses GHCi to collect the
free variables (by type-checking the expression and parsing the error messages) and implicitly
add lambda abstractions for them. QuickCheck relies on the <code>Arbitrary</code> type class for random
generation, and thus the properties must be specific enough. The <code>doctest</code> library uses the
<code>polyQuickCheck</code> function (provided by QuickCheck, dependent on Template Haskell) to test the
properties, which defaults all type variables to <code><a href="../base/Prelude.html#t:Integer" title="Prelude">Integer</a></code>, making the properties monomorphic.</p><p><code>doctest-driver</code> cannot rely on GHCi, and it is hard to use Template Haskell (due to its phase
restrictions) in generated tests. Therefore, neither of the above features is supported. All
the free variables must be introduced explicitly through the lambda abstraction, and all input
variables should have a monomorphic type (possibly by adding type annotations).</p><pre>\(xs :: [Int]) -&gt; reverse (reverse xs) == xs</pre><p>This example above describes the well-recognised property for the <code><a href="../base/Data-List.html#v:reverse" title="Data.List">reverse</a></code> function. Notice
the explicit lambda abstraction and the accompanying type annotation.</p></div><a href="#g:4" id="g:4"><h2>Verbatim Examples</h2></a><div class="doc"><p>Haddock also allows verbatim code blocks, with each line preceded by a bird track (<code>&gt;</code>). To
make such code blocks work as tests, use the <code>test</code> instruction as follows:</p><pre>-- doctest:test
(1 + 1) `shouldBe` (2 :: Int)</pre><p>These examples are implicitly put into a <code>do</code> block for the <code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> monad, and the whole block is
copied verbatim into the generated text (except adjusting the indentation). Unlike REPL-style
examples, we cannot specify expected output lines, and the comparison must be done explicitly.</p><p>Verbatim examples are more flexible than REPL-style examples.</p><p>First, REPL-style examples call <code><a href="../base/Prelude.html#v:show" title="Prelude">show</a></code> on the result to compare with the expected output lines.
When the result type does not implement <code><a href="../base/Prelude.html#t:Show" title="Prelude">Show</a></code>, or when the <code><a href="../base/Prelude.html#t:Show" title="Prelude">Show</a></code> instance does not provide
sufficient meaningful information, REPL-style examples are not suitable.</p><p>Second, Haddock strips leading whitespace from test lines in REPL-style examples. To ensure the
behaviour of test examples is consistent with the way they are rendered, <code>doctest-driver</code> also
strips the leading whitespace. This means REPL-style examples are not suitable for multiline
test cases with indentation.</p></div><a href="#g:5" id="g:5"><h2>Verbatim Properties</h2></a><div class="doc"><p>Haddock only supports single-line properties. For multiline properties, one can write them as
verbatim examples by calling the <code>property</code> function from QuickCheck:</p><pre>-- doctest:setup-import
import Test.QuickCheck</pre><p>(This <code>setup-import</code> block adds an <code>import</code> statement to the generated module. The details will
be explained in later sections, and readers can safely ignore it for now.)</p><pre>-- doctest:test
property $ \(xs :: [Int]) -&gt;
  reverse (reverse xs) == xs</pre><p>For this specific use case, <code>doctest-driver</code> also provides the <code>property</code> instruction to write
verbatim properties. One should prefer the following (using <code>property</code>) over the above (using
<code>test</code> and call <code>property</code> explicitly) to better express the intention concisely:</p><pre>-- doctest:property
\(xs :: [Int]) -&gt;
  reverse (reverse xs) == xs</pre></div><a href="#g:6" id="g:6"><h2>Support API</h2></a><div class="top"><p class="src"><a id="v:shouldMatch" class="def">shouldMatch</a> :: (<a href="../base/GHC-Stack.html#t:HasCallStack" title="GHC.Stack">HasCallStack</a>, <a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a> a, <a href="../base/Prelude.html#t:Show" title="Prelude">Show</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a)) =&gt; a -&gt; <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../HUnit/Test-HUnit-Lang.html#t:Assertion" title="Test.HUnit.Lang">Assertion</a> <span class="fixity">infix 1</span><span class="rightedge"></span> <a href="src/Test.DocTest.Support.html#shouldMatch" class="link">Source</a> <a href="#v:shouldMatch" class="selflink">#</a></p><div class="doc"><p>Expect that the value <code>a</code>, when <code><a href="../base/Prelude.html#v:show" title="Prelude">show</a></code>n, <code><a href="Test-DocTest-FuzzyMatch.html#v:match" title="Test.DocTest.FuzzyMatch">match</a></code>es the pattern string.</p><p>Simple usage: no pattern in the pattern string.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure ((123 :: Int) `shouldMatch` &quot;123&quot;)
</code></strong>Right ()
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure ((123 :: Int) `shouldMatch` &quot;000&quot;)
</code></strong>Left (HUnitFailure (Just (SrcLoc {...})) (ExpectedButGot Nothing &quot;000&quot; &quot;123&quot;))
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure (&quot;&#27979;&#35797;&#171;&#945;&#946;&#187;&quot; `shouldMatch` &quot;\&quot;\\27979\\35797\\171\\945\\946\\187\&quot;&quot;)
</code></strong>Right ()
</pre><p>Advanced usage: <code>...</code> for inline and multiline wildcard.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure (True `shouldMatch` &quot;T...e&quot;)
</code></strong>Right ()
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure (&quot;some fancy string&quot; `shouldMatch` &quot;\&quot;some ... string\&quot;&quot;)
</code></strong>Right ()
</pre><pre>-- doctest:setup-top
data Verbatim = Verbatim String
instance Show Verbatim where show (Verbatim s) = s</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure (Verbatim &quot;aaa\n\nbbb&quot; `shouldMatch` &quot;aaa\n...\nbbb&quot;)
</code></strong>Right ()
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>try @HUnitFailure (Verbatim &quot;aaa\nccc\nddd\nbbb&quot; `shouldMatch` &quot;aaa\n...\nbbb&quot;)
</code></strong>Right ()
</pre></div></div><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:ReplResult" class="def">ReplResult</a> a <span class="keyword">where ...</span> <a href="src/Test.DocTest.Support.html#ReplResult" class="link">Source</a> <a href="#t:ReplResult" class="selflink">#</a></p><div class="doc"><p>Result type of running as a <code><a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a></code>. Unfortunately, this cannot handle polymorphic types
 without a known top-level type constructor.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> (<a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a) = a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a = a</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:ReplAction" class="def">ReplAction</a> a <span class="keyword">where</span> <a href="src/Test.DocTest.Support.html#ReplAction" class="link">Source</a> <a href="#t:ReplAction" class="selflink">#</a></p><div class="doc"><p>GHCi session supports both evaluating pure values and running <code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> actions. Use this type
 class to let the compiler deduce which one a test line should use.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:replAction" class="def">replAction</a> :: a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a) <a href="src/Test.DocTest.Support.html#replAction" class="link">Source</a> <a href="#v:replAction" class="selflink">#</a></p><div class="doc"><p>Embed into an <code><a href="../base/Prelude.html#t:IO" title="Prelude">IO</a></code> action.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>replAction (123 :: Int)
</code></strong>123
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>replAction (pure 123 :: IO Int)
</code></strong>123
</pre></div></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:ReplAction">Instances</h4><details id="i:ReplAction" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:ReplAction:ReplAction:1"></span> a <a href="../base/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a =&gt; <a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a> a</span> <a href="src/Test.DocTest.Support.html#line-393" class="link">Source</a> <a href="#t:ReplAction" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:ReplAction:ReplAction:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-DocTest-Support.html">Test.DocTest.Support</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:replAction">replAction</a> :: a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> a) <a href="src/Test.DocTest.Support.html#replAction" class="link">Source</a> <a href="#v:replAction" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:ReplAction:ReplAction:2"></span> <a href="Test-DocTest-Support.html#t:ReplAction" title="Test.DocTest.Support">ReplAction</a> (<a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a)</span> <a href="src/Test.DocTest.Support.html#line-396" class="link">Source</a> <a href="#t:ReplAction" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:ReplAction:ReplAction:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Test-DocTest-Support.html">Test.DocTest.Support</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:replAction">replAction</a> :: <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> (<a href="Test-DocTest-Support.html#t:ReplResult" title="Test.DocTest.Support">ReplResult</a> (<a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a)) <a href="src/Test.DocTest.Support.html#replAction" class="link">Source</a> <a href="#v:replAction" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:7" id="g:7"><h1>Captures</h1></a><div class="doc"><p>Sometimes we need some textual contents in our tests, and it might also be useful to let the
user see them while browsing the documentation. In such cases, we can use the <code>capture</code>
instruction in a verbatim code block. The whole block is unindented by stripping the common
whitespace prefix. The captured text does not contain a trailing <code>'\n'</code> character. To force
adding one, leave an empty line at the end of the verbatim code block.</p><p>It is most natural to start with the test cases making use of the captured variable:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>take 15 stringCapture
</code></strong>&quot;This text block&quot;
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>length (lines stringCapture)
</code></strong>2
</pre><p>and show its contents afterwards:</p><pre>-- doctest:capture(stringCapture :: String)
This text block is supposed to be captured as a String variable.
Everything besides the first line (the doctest instruction) is captured verbatim.</pre><p>Sometimes, our tests expect the contents to be saved somewhere as a file. The <code>capture</code>
instruction conveniently allow specifying the variable to have type <code><a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a></code> in such cases:</p><pre>-- doctest:capture(fileCapture :: FilePath)
This text block will be saved to a temporary file.
The file is written once and reused for all test cases in this group.
Therefore, it is only suitable for reading.
For advanced usage involving editing and deletion, use a String capture with a &quot;before&quot; or &quot;around&quot; hook.</pre><p>The <code>fileCapture :: <code><a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a></code></code> variable is then available for use.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>fileContents &lt;- readFile fileCapture
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>length (lines fileContents)
</code></strong>4
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>lines fileContents !! 2
</code></strong>&quot;Therefore, it is only suitable for reading.&quot;
</pre><p>We can also capture texts as <code>Text</code>s and <code>ByteString</code>s (strict or lazy).</p><p>For strict <code><a href="T.html#v:Text" title="T">Text</a></code>, use <code>Text</code> or <code>Strict.Text</code>:</p><pre>-- doctest:capture(captureStrictText :: Text)
strict text</pre><pre>-- doctest:capture(captureStrictTextAlt :: Strict.Text)
strict text</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureStrictText :: T.Text
</code></strong>&quot;strict text&quot;
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureStrictText == captureStrictTextAlt
</code></strong>True
</pre><p>For lazy <code><a href="TL.html#v:Text" title="TL">Text</a></code>, use <code>Lazy.Text</code>:</p><pre>-- doctest:capture(captureLazyText :: Lazy.Text)
lazy text</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureLazyText :: TL.Text
</code></strong>&quot;lazy text&quot;
</pre><p>The same applies to strict and lazy <code><a href="../bytestring/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></code>s, as well as <code><a href="../bytestring/Data-ByteString-Short.html#t:ShortByteString" title="Data.ByteString.Short">ShortByteString</a></code>s:</p><pre>-- doctest:capture(captureStrictByteString :: ByteString)
strict byte string</pre><pre>-- doctest:capture(captureStrictByteStringAlt :: Strict.ByteString)
strict byte string</pre><pre>-- doctest:capture(captureLazyByteString :: Lazy.ByteString)
lazy byte string</pre><pre>-- doctest:capture(captureShortByteString :: ShortByteString)
short byte string</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureStrictByteString :: ByteString
</code></strong>&quot;strict byte string&quot;
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureStrictByteString == captureStrictByteStringAlt
</code></strong>True
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureLazyByteString :: LazyByteString
</code></strong>&quot;lazy byte string&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>captureShortByteString :: ShortByteString
</code></strong>&quot;short byte string&quot;
</pre><p><code>doctest-driver</code> will take care of correctly wrapping the text contents into the requested
types. For byte strings, the text is encoded as UTF-8. No extra import is required for the
captures themselves, but in order to use them in a meaningful way, one may still need to add
explicit dependency on the <code>text</code> and <code>bytestring</code> packages, and import the required modules.
In this example, we use type ascriptions to assert that the captured variables have the
expected type, which requires the following imports:</p><pre>-- doctest:setup-import
import qualified Data.Text as T (Text)
import qualified Data.Text.Lazy as TL (Text)
import Data.ByteString (ByteString)
import Data.ByteString.Lazy (LazyByteString)
import Data.ByteString.Short (ShortByteString)</pre><p>If your specific use case requires capturing text in encodings other than UTF-8, you can use
<code><a href="../base/Data-String.html#t:String" title="Data.String">String</a></code> capture and do the encoding yourself. We expect UTF-8 to be enough for most use cases.</p></div><div class="top"><p class="src"><a id="v:withWriteTempFile" class="def">withWriteTempFile</a> :: (<a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a> -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a) -&gt; <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> a <a href="src/Test.DocTest.Support.html#withWriteTempFile" class="link">Source</a> <a href="#v:withWriteTempFile" class="selflink">#</a></p><div class="doc"><p>Create a temporary file, write the given contents, run the action with the <code><a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a></code>, and
 remove the file at last. Used to implement <code><a href="../base/Prelude.html#t:FilePath" title="Prelude">FilePath</a></code> captures.</p></div></div><div class="top"><p class="src"><a id="v:textStrict" class="def">textStrict</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../text/Data-Text.html#t:Text" title="Data.Text">Text</a> <a href="src/Test.DocTest.Support.html#textStrict" class="link">Source</a> <a href="#v:textStrict" class="selflink">#</a></p><div class="doc"><p>Convert a string to strict text.</p></div></div><div class="top"><p class="src"><a id="v:textLazy" class="def">textLazy</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../text/Data-Text-Lazy.html#t:Text" title="Data.Text.Lazy">Text</a> <a href="src/Test.DocTest.Support.html#textLazy" class="link">Source</a> <a href="#v:textLazy" class="selflink">#</a></p><div class="doc"><p>Convert a string to lazy text.</p></div></div><div class="top"><p class="src"><a id="v:byteStringStrict" class="def">byteStringStrict</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Test.DocTest.Support.html#byteStringStrict" class="link">Source</a> <a href="#v:byteStringStrict" class="selflink">#</a></p><div class="doc"><p>Convert a string to strict byte string.</p></div></div><div class="top"><p class="src"><a id="v:byteStringLazy" class="def">byteStringLazy</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString-Lazy.html#t:LazyByteString" title="Data.ByteString.Lazy">LazyByteString</a> <a href="src/Test.DocTest.Support.html#byteStringLazy" class="link">Source</a> <a href="#v:byteStringLazy" class="selflink">#</a></p><div class="doc"><p>Convert a string to lazy byte string.</p></div></div><div class="top"><p class="src"><a id="v:shortByteString" class="def">shortByteString</a> :: <a href="../base/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../bytestring/Data-ByteString-Short.html#t:ShortByteString" title="Data.ByteString.Short">ShortByteString</a> <a href="src/Test.DocTest.Support.html#shortByteString" class="link">Source</a> <a href="#v:shortByteString" class="selflink">#</a></p><div class="doc"><p>Convert a string to short byte string.</p></div></div><a href="#g:8" id="g:8"><h1>Hooks</h1></a><div class="top"><p class="src"><a id="v:markUsed" class="def">markUsed</a> :: a -&gt; <a href="../base/Prelude.html#t:IO" title="Prelude">IO</a> () <a href="src/Test.DocTest.Support.html#markUsed" class="link">Source</a> <a href="#v:markUsed" class="selflink">#</a></p><div class="doc"><p>No-op function. Used to silence the &quot;variable unused&quot; warning.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.31.0</p></div></body></html>