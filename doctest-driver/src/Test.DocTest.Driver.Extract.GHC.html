<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Description: DocTest extraction using the GHC API.</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Copyright: Copyright 2024, Ruifeng Xie</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- License: AGPL-3.0-or-later</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Maintainer: Ruifeng Xie &lt;ruifengx@outlook.com&gt;</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- DocTest extraction using the GHC API. GHC environment and options are handled here.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html"><span class="hs-identifier">Test.DocTest.Driver.Extract.GHC</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#parseModulesIn"><span class="hs-identifier">parseModulesIn</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#parseModules"><span class="hs-identifier">parseModules</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isSuffixOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">doesDirectoryExist</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">listDirectory</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.cabal/store/ghc-9.10.2-aac9/ghc-paths-0.1.0.12-efccc1fc4d1a3b7885d2fb4d264ab0000c9a064b07872c871335eea466bf6f08/share/doc/html/src/GHC.Paths.html"><span class="hs-identifier">GHC.Paths</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ghc</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Data.Graph.Directed</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">flattenSCCs</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Session</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DynFlags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">backend</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ghcLink</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ghcMode</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gopt_set</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Unit.Module.Graph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">filterToposortToModules</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Utils.Panic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GhcException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UsageError</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwGhcException</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="annot"><span class="hs-comment">-- | Parse all the files in all the directories in the given list.</span></span><span>
</span><span id="line-27"></span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#parseModulesIn"><span class="hs-identifier hs-type">parseModulesIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">GHC.ParsedModule</span></span><span class="hs-special">]</span><span>
</span><span id="line-28"></span><span id="parseModulesIn"><span class="annot"><span class="annottext">parseModulesIn :: [String] -&gt; [String] -&gt; IO [ParsedModule]
</span><a href="Test.DocTest.Driver.Extract.GHC.html#parseModulesIn"><span class="hs-identifier hs-var hs-var">parseModulesIn</span></a></span></span><span> </span><span id="local-6989586621679242549"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242549"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679242550"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242550"><span class="hs-identifier hs-var">dirs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-29"></span><span>  </span><span id="local-6989586621679242551"><span class="annot"><a href="#local-6989586621679242551"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (t :: Type -&gt; Type) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; [String]) -&gt; IO [[String]] -&gt; IO [String]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO [String]) -&gt; [String] -&gt; IO [[String]]
forall (t :: Type -&gt; Type) (f :: Type -&gt; Type) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [String]
</span><a href="Test.DocTest.Driver.Extract.GHC.html#recursiveListDirectory"><span class="hs-identifier hs-var">recursiveListDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242550"><span class="hs-identifier hs-var">dirs</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#parseModules"><span class="hs-identifier hs-type">parseModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679242549"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;.hs&quot;</span></span><span> </span><span class="annot"><span class="hs-operator">`isSuffixOf`</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679242551"><span class="hs-identifier hs-type">paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="annot"><span class="hs-comment">-- | Parse all the files in the given list.</span></span><span>
</span><span id="line-33"></span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#parseModules"><span class="hs-identifier hs-type">parseModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">GHC.ParsedModule</span></span><span class="hs-special">]</span><span>
</span><span id="line-34"></span><span id="parseModules"><span class="annot"><span class="annottext">parseModules :: [String] -&gt; [String] -&gt; IO [ParsedModule]
</span><a href="Test.DocTest.Driver.Extract.GHC.html#parseModules"><span class="hs-identifier hs-var hs-var">parseModules</span></a></span></span><span> </span><span id="local-6989586621679242556"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242556"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679242557"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242557"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Ghc [ParsedModule] -&gt; IO [ParsedModule]
forall a. Maybe String -&gt; Ghc a -&gt; IO a
</span><span class="hs-identifier hs-var">GHC.runGhc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="file:///home/runner/.cabal/store/ghc-9.10.2-aac9/ghc-paths-0.1.0.12-efccc1fc4d1a3b7885d2fb4d264ab0000c9a064b07872c871335eea466bf6f08/share/doc/html/src/GHC.Paths.html#libdir"><span class="hs-identifier hs-var">GHC.libdir</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; Ghc ()
</span><a href="Test.DocTest.Driver.Extract.GHC.html#handleOptions"><span class="hs-identifier hs-var">handleOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242556"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span id="local-6989586621679242561"><span class="annot"><a href="#local-6989586621679242561"><span class="hs-identifier hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Ghc Target) -&gt; [String] -&gt; Ghc [Target]
forall (t :: Type -&gt; Type) (m :: Type -&gt; Type) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: Type -&gt; Type) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679242563"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242563"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe UnitId -&gt; Maybe Phase -&gt; Ghc Target
forall (m :: Type -&gt; Type).
GhcMonad m =&gt;
String -&gt; Maybe UnitId -&gt; Maybe Phase -&gt; m Target
</span><span class="hs-identifier hs-var">GHC.guessTarget</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242563"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242557"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">GHC.setTargets</span></span><span> </span><span class="annot"><a href="#local-6989586621679242561"><span class="hs-identifier hs-type">targets</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span id="local-6989586621679242566"><span class="annot"><a href="#local-6989586621679242566"><span class="hs-identifier hs-var">modules</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flattenSCCs</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">filterToposortToModules</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GHC.topSortModuleGraph</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.depanal</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.parseModule</span></span><span> </span><span class="annot"><a href="#local-6989586621679242566"><span class="hs-identifier hs-type">modules</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#handleOptions"><span class="hs-identifier hs-type">handleOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ghc</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span id="handleOptions"><span class="annot"><span class="annottext">handleOptions :: [String] -&gt; Ghc ()
</span><a href="Test.DocTest.Driver.Extract.GHC.html#handleOptions"><span class="hs-identifier hs-var hs-var">handleOptions</span></a></span></span><span> </span><span id="local-6989586621679242572"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679242572"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>  </span><span id="local-6989586621679242573"><span class="annot"><a href="#local-6989586621679242573"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ghc Logger
forall (m :: Type -&gt; Type). HasLogger m =&gt; m Logger
</span><span class="hs-identifier hs-var">GHC.getLogger</span></span><span>
</span><span id="line-47"></span><span>  </span><span id="local-6989586621679242575"><span class="annot"><a href="#local-6989586621679242575"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#setFlags"><span class="hs-identifier hs-type">setFlags</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.getSessionDynFlags</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679242578"><span class="annot"><a href="#local-6989586621679242578"><span class="hs-identifier hs-var">flags'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242579"><span class="annot"><a href="#local-6989586621679242579"><span class="hs-identifier hs-var">unknown</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242580"><span class="annot"><a href="#local-6989586621679242580"><span class="hs-identifier hs-var">_warnings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.parseDynamicFlags</span></span><span> </span><span class="annot"><a href="#local-6989586621679242573"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679242575"><span class="hs-identifier hs-type">flags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.noLoc</span></span><span> </span><span class="annot"><a href="#local-6989586621679242572"><span class="hs-identifier hs-type">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621679242579"><span class="hs-identifier hs-type">unknown</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242584"><span class="annot"><a href="#local-6989586621679242584"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unknown flags: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Located String -&gt; String) -&gt; [Located String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Located String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621679242579"><span class="hs-identifier hs-var">unknown</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">throwGhcException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UsageError</span></span><span> </span><span class="annot"><a href="#local-6989586621679242584"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">GHC.setSessionDynFlags</span></span><span> </span><span class="annot"><a href="#local-6989586621679242578"><span class="hs-identifier hs-type">flags'</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#setFlags"><span class="hs-identifier hs-type">setFlags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DynFlags</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DynFlags</span></span><span>
</span><span id="line-55"></span><span id="setFlags"><span class="annot"><span class="annottext">setFlags :: DynFlags -&gt; DynFlags
</span><a href="Test.DocTest.Driver.Extract.GHC.html#setFlags"><span class="hs-identifier hs-var hs-var">setFlags</span></a></span></span><span> </span><span id="local-6989586621679242588"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679242588"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><span class="hs-identifier hs-var">gopt_set</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621679242588"><span class="hs-identifier hs-var">flags</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><span class="hs-identifier hs-var">GHC.Opt_Haddock</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">backend</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.noBackend</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ghcMode</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.CompManager</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ghcLink</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GHC.NoLink</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#recursiveListDirectory"><span class="hs-identifier hs-type">recursiveListDirectory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span id="recursiveListDirectory"><span class="annot"><span class="annottext">recursiveListDirectory :: String -&gt; IO [String]
</span><a href="Test.DocTest.Driver.Extract.GHC.html#recursiveListDirectory"><span class="hs-identifier hs-var hs-var">recursiveListDirectory</span></a></span></span><span> </span><span id="local-6989586621679242593"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242593"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>  </span><span id="local-6989586621679242594"><span class="annot"><a href="#local-6989586621679242594"><span class="hs-identifier hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242593"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; IO [String] -&gt; IO [String]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [String]
</span><span class="hs-identifier hs-var">listDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242593"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679242594"><span class="hs-identifier hs-type">children</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679242595"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242595"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679242596"><span class="annot"><a href="#local-6989586621679242596"><span class="hs-identifier hs-var">isDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesDirectoryExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679242595"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679242596"><span class="hs-identifier hs-type">isDir</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Test.DocTest.Driver.Extract.GHC.html#recursiveListDirectory"><span class="hs-identifier hs-type">recursiveListDirectory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679242595"><span class="hs-identifier hs-type">child</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679242595"><span class="hs-identifier hs-type">child</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span></pre></body></html>